// ==========================================
// layout/_list.scss
// 訂單卡片列表
// ==========================================
@use "sass:color";
@use "utilities/config"as *;
@use "utilities/mixins"as *;

.list-wrap {
    margin-top: 6px;
}

.card.order {
    position: relative;
    background: $card-bg;
    border: 1px solid $bd;
    border-radius: $radius;
    padding: 3px 7px;
    transition: all .2s ease;
    @include respond(md) {
        padding: 7px 10px;
    }

    &+.card.order {
        margin-top: 8px;
    }

    &:hover {
        box-shadow: $shadow-sm;
    }

    // --- 1. Loading 狀態 ---
    &.is-busy {
        cursor: wait;
        pointer-events: none; // 鎖定所有按鈕
        filter: grayscale(.5);
        opacity: .7;

        &::after {
            content: '處理中...';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, .6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: $primary;
            z-index: 10;
        }
    }

    // --- 2. 成功完成狀態 ---
    &.is-success {
        border-color: $primary !important;
        background-color: $primary-overly !important;
        transform: scale(.98); // 輕微縮小，有收工的感覺
        // opacity: .1;

        .card-success-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            // background: $primary-overly;
            background: rgba(255, 255, 255, .8);
            display: flex;
            align-items: center;
            justify-content: center;
            color: $primary;
            font-weight: 700;
            font-size: $font-size-base;
            z-index: 20;
            border-radius: $radius;

            .check-icon {
                font-size: $font-size-lg;
                margin-right: $space-2;
            }
        }
    }


    &.state-overdue,
    &.state-tomorrow,
    &.state-today {
        border-inline-width: 2px;
    }
    &.state-overdue {
        border-inline-color: $state-overdue;
    }
    &.state-tomorrow {
        border-inline-color: $state-tomorrow;
    }
    &.state-today {
        border-inline-color: $state-today;
    }

    // 內層結構
    .card__inner {
        display: grid;
        grid-template-columns: 1fr auto;
        align-items: center;
        gap: 0 7px;
    }

    .col {
        font-size: $font-size-base;

        &.b {
            height: 100%;

            .cell.actions {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 2px;
                width: 65px;
                height: 100%;
                align-items: center;
                @include respond(md) {
                    grid-template-columns: 1fr;
                    width: 28px;
                }
                .icon-btn {
                    width: 100%;
                    // height: 28px;
                    &[data-action="quick-done"] {
                        color: lighten($primary, 15%);
                        // border-color: $primary-weak;
                    }
                    // 針對「收合」按鈕：強迫佔據兩欄寬度 (全寬)
                    &[data-action="toggle"] {
                        grid-column: 1 / -1;
                        // height: 22px; // 第二排可以稍微矮一點點，比較精緻
                        @include respond(md) {
                            grid-column: auto;
                        }
                    }
                }
            }
        }
    }

    // 行結構
    .row {
        display: grid;
        align-items: center;
        gap: 0 7px;
        padding: 1px 0;
        line-height: normal;

        .cell {
            &.oStatus {
                display: inline-block;
                padding: 1px 6px;
                font-size: $font-size-sm;
                border: 1px solid $ink;
                border-radius: $radius-sm;
                color: $ink;
                line-height: 1.3;

                @include respond(md) {
                    font-size: $font-size-sm;
                }

                span {
                    color: $ink;
                }
            }

            &.meta {
                display: flex;
                align-items: center;
                color: $muted;
                gap: 9px;
                text-align: justify;
                letter-spacing: -.5px;

                &.oShippay {
                    @include respond(md) {
                        grid-column: 1 / -1;
                        padding: 3px 0 3px;
                    }
                }
                &.oName {
                }
                &.oName,
                &.oItem {
                    span {
                        @include respond(md) {
                            max-width: 20vw;
                            min-width: 0;   // 防止被內容撐爆
                            overflow: hidden;
                            white-space: nowrap;
                            text-overflow: ellipsis;
                        }
                    }
                }
            }

            &.oId {
                display: inline-block;
                font-weight: 500;
                color: rgba($muted, .7);
                letter-spacing: -1.5px;
            }

            &.oDate {
                color: $ink;
                background: $bg-soft;
                padding: 0 3px;
                border-radius: $radius-sm;
                letter-spacing: -.3px;
            }

            &.oAmount {
                font-weight: 500;
                color: $ink;
                letter-spacing: -.7px;
            }
        }

        // A 行：ID | 日期 | 標籤
        &.a {
            grid-template-columns: repeat(3, auto) 1fr;
        }

        // B 行：平台 | 客戶 | 分類 | 金額
        &.b {
            grid-template-columns: repeat(3, auto) 1fr;
        }
    }

    // 訂單狀態樣式
    &[data-status="doing"] {
        .row .cell.oStatus {
            background: $status-doing;
        }
    }

    &[data-status="done"] {
        opacity: .77;
        background: $status-done;
        .row {
            .cell {
                &.oStatus {
                    background: $status-done;
                }
                &.oDate,
                &.oAmount {
                    color: $muted;
                }

            }
        }
        .icon-btn[data-action="quick-done"] {
            display: none;
        }
    }

    &[data-status="cancel"] {
        text-decoration: line-through;

        .row .cell.oStatus {
            background: $status-cancel;
            text-decoration: none;
        }
    }
    &[data-pay="未付款"] .icon-btn[data-action="quick-done"] {
        opacity: .3;
        filter: grayscale(1); // 變灰色
        cursor: not-allowed;
    }

    // 詳細內容展開區
    .detail {
        display: grid;
        font-size: $font-size-sm;

        @include respond(md) {
            font-size: $font-size-base;
        }

        &-group {
            margin-top: $space-1;
            span {
                margin-left: $space-1;
            }
            &::before {
                content: "";
                width: 100%;
                height: 1px;
                display: block;
                border-top: 1px dashed $bd;
            }
            &:first-child::before {
                border-top-style: solid;
            }

            .g-body {
                display: grid;
                grid-template-columns: repeat(3, minmax(0, 1fr));
                gap: 1px 7px;
                margin-block: $space-1;

                @include respond(md) {
                    grid-template-columns: 1fr;
                    gap: 3px 7px;
                }

                .kv {
                    display: grid;
                    grid-template-columns: minmax(0, 77px) 1fr;
                    gap: 0 7px;
                    align-items: start;

                    b {
                        font-weight: 600;
                        color: $muted;
                        white-space: nowrap;
                        letter-spacing: -0.3px;
                    }

                    span {
                        color: $ink;
                        word-break: break-word;
                        flex: 1;
                        text-align: justify;
                        line-height: normal;
                        letter-spacing: -0.3px;
                    }
                }
            }
        }
    }
}